#include <stdio.h>
#include <stdlib.h>
#include <sys/types.h>
#include "liste.h"

struct fiche_proc {
	int pid;
	Etat etat;
	Liste_proc suivant;
};

int appartient(int pid, Liste_proc l_proc) {
	if(l_proc == NULL) {
		return 0;
	}
	else if(l_proc->pid == pid) {
		return 1;
	}
	else {
		return appartient(pid, l_proc->suivant);
	}
}

void inserer(int pid, Etat etat, Liste_proc* pl_proc) {
	
	Liste_proc elt;
	Liste_proc l_proc;
	
	// Si la liste n'existe pas terminer
	if(pl_proc == NULL) {
		exit(1);
	}
	
	// Création du processus à insérer
	elt = (Liste_proc)malloc(sizeof(struct fiche_proc));
	elt->pid = pid;
	elt->etat = etat;
	
	// Si la liste est vide
	if(*pl_proc == NULL) {
		*pl_proc = elt;
	}
	else {
		l_proc = *pl_proc;
		
		// Tant qu'on n'est pas arrivé à la queue
		while(l_proc->suivant != NULL) {
			l_proc = l_proc->suivant;
		}
		// *l_proc n'a pas de suivant
		
		l_proc->suivant = elt;
	}
}

void modifierEtat(int pid, Etat etat, Liste_proc l_proc) {
	
	// Si la liste n'est pas vide
	if(l_proc != NULL) {
		
		if(l_proc->pid == pid) {
			l_proc->etat = etat;
		}
		else {
			modifierEtat(pid, etat, l_proc->suivant);
		}
	}
}

void afficher(Liste_proc l_proc) {
	
	Liste_proc elt = l_proc;
	
	printf("Processus :\n");
	printf("-----------\n");
	
	// Tant qu'il y a des processuss à lister
	while(elt != NULL) {
		// Afficher les données du processus
		if(elt->etat == PRET) {
			printf("Processus - %d - PRET\n", elt->pid);
		}
		else if(elt->etat == SUSPENDU) {
			printf("Processus - %d - SUSPENDU\n", elt->pid);
		}
		// Passer au suivant
		elt = elt->suivant;
	}
	printf("\n");
}

int lireNumTete(Liste_proc l_proc) {
	if(l_proc == NULL) {
		exit(1);
	}
	else {
		return l_proc->pid;
	}
}

void supprimer(int pid, Liste_proc* pl_proc) {
	
	Liste_proc l_proc;
	
	// Si la liste n'existe pas terminer
	if(pl_proc == NULL) {
		exit(1);
	}
	// Si la liste n'est pas vide
	if(*pl_proc != NULL) {
		l_proc = *pl_proc;
		
		// Si la tête de liste est le processus à retirer
		if(l_proc->pid == pid) {
			*pl_proc = l_proc->suivant;
		}
		else {
			supprimer(pid, &(l_proc->suivant));
		}
	}
}








