#include <stdio.h>
#include <stdlib.h>
#include <sys/types.h>
#include "list.h"

/* Fiche d'identité d'un processus */
struct sProcess {
	int pid;
	State state;
};

/* Case d'une liste de fiches d'identité de processus */
struct sCaseProcess {
	Process *process;
	ListProcess next;
};

/* Détermine si le processus d'identifiant pid appartient à la liste list */
int belong(int pid, ListProcess list) {
	
	ListProcess list_c = list;
	
	while(list_c != NULL && list_c->process->pid != pid) {
		list_c = list_c->next;
	}
	
	if(list_c == NULL) {
		return 0;
	}
	else {
		return 1;
	}
}

/* Ajoute le processus d'identifiant pid et d'état state à la liste *p_list */
void add(int pid, State state, ListProcess* p_list) {
	
	ListProcess list;
	
	/* Création du processus à insérer */
	Process *process = (pProcess)malloc(sizeof(Process));
	process->pid = pid;
	process->state = state;
	
	/* Création de la case de liste à insérer */
	ListProcess pCase = (ListProcess)malloc(sizeof(struct sCaseProcess));
	pCase->process = process;
	
	/* Si la liste n'existe pas s'arrêter */
	if(p_list == NULL) {
		exit(1);
	}
	
	/* Si la liste est vide insérer le processus en tête */
	if(*p_list == NULL) {
		*p_list = pCase;
	}
	else {
		list = *p_list;
		
		while(list->next != NULL) {
			list = list->next;
		}
		
		list->next = pCase;
	}
}

/* Change l'état du processus d'identifiant pid pour state dans la liste list */
void changeState(int pid, State state, ListProcess list) {
	
	ListProcess list_c = list;
	
	while(list_c != NULL && list_c->process->pid != pid) {
		list_c = list_c->next;
	}
	
	if(list_c != NULL) {
		list_c->process->state = state;
	}
}

/* Affiche la liste de processus list avec leurs états */
void display(ListProcess list) {
	
	Process process;
	ListProcess list_c = list;
	
	printf("Process :\n");
	printf("----------------\n");
	
	while(list_c != NULL) {
		printf("Process n°%d - ", list_c->process->pid);
		if(list_c->process->state == READY) {
			printf("READY");
		}
		else if(list_c->process->state == SUSPENDED) {
			printf("SUSPENDED");
		}
		else if(list_c->process->state == MISSING) {
			printf("MISSING");
		}
		printf("\n");
		list_c = list_c->next;
	}
}

int rem(int pid, ListProcess* p_list) {
	
	ListProcess list;
	ListProcess next;
	
	/* Si la liste n'existe pas terminer */
	if(p_list == NULL) {
		exit(1);
	}
	
	list = *p_list;
	
	/* Si la liste est vide */
	if(list == NULL) {
		*p_list = NULL;
		free(list);
	}
	/* Si la liste n'est pas vide */
	else {
		while(list->next != NULL && list->next->process->pid != pid) {
			list = list->next;
		}
		
		if(list->next != NULL) {
			next = list->next->next;
			free(list->next);
			list->next = next;
		}
	}
}







